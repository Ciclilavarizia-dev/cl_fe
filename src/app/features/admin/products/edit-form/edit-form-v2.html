<button type="button" class="btn btn-link return-button" routerLink="/admin/products">
    ← Back to products
</button>
<div class="edit-page">
    <div class="row">
        <div class="col-4">
            <div class="list-group" id="section-list">
                <a class="list-group-item list-group-item-action" [routerLink]="[]" fragment="general"
                    (click)="scrollTo('general')">General</a>
                <a class="list-group-item list-group-item-action" [routerLink]="[]" fragment="pricing"
                    (click)="scrollTo('pricing')">Pricing</a>
                <a class="list-group-item list-group-item-action" [routerLink]="[]" fragment="attributes"
                    (click)="scrollTo('attributes')">Attributes</a>
                <a class="list-group-item list-group-item-action" [routerLink]="[]" fragment="availability"
                    (click)="scrollTo('availability')">Availability</a>
            </div>
        </div>
        <div class="col-8">

            <form class="edit-form" [formGroup]="form">

                <div class="section-scrollspy border border-secondary-subtle rounded" data-bs-spy="scroll"
                    data-bs-target="#section-list" data-bs-smooth-scroll="true" tabindex="0">

                    <section class="form-section" id="general">
                        <h3>General</h3>
                        <div class="form-group">
                            <label for="category">Category</label>
                            <select class="form-control" formControlName="productCategoryId" name="category"
                                id="category">
                                <option [ngValue]="null">-- Select category --</option>
                                <option *ngFor="let c of categories" [ngValue]="c.productCategoryId">{{ c.name }}
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="model">Model</label>
                            <select class="form-control" formControlName="productModelId" name="model" id="model">
                                <option [ngValue]="null">-- Select model --</option>
                                <option *ngFor="let m of models" [ngValue]="m.productModelId">{{ m.name }}</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productNumber">Product number</label>
                            <input type="text" class="form-control" formControlName="productNumber" name="productNumber"
                                id="productNumber">
                            <small class="text-muted" *ngIf="hasOrders">
                                Not editable. Product has orders.
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="name">Product name</label>
                            <input type="text" class="form-control" formControlName="name" name="name" id="name">
                        </div>
                    </section>

                    <section class="form-section" id="pricing">
                        <h3>Pricing</h3>
                        <div class="row">
                            <div class="col">
                                <label for="listPrice">List price</label>
                                <input type="number" class="form-control" formControlName="listPrice" step="0.01">
                                <div class="text-danger mt-1" *ngIf="form.errors?.['priceMismatch']">
                                    List price cannot be lower than standard cost.
                                </div>
                            </div>

                            <div class="col">
                                <label for="standardCost">Standard cost</label>
                                <input type="number" class="form-control" formControlName="standardCost" step="0.01">
                            </div>
                        </div>
                    </section>

                    <section class="form-section" id="attributes">
                        <h3>Attributes</h3>

                        <div class="row">
                            <div class="col">
                                <label for="color">Color</label>
                                <input type="text" class="form-control" formControlName="color">
                            </div>
                            <div class="col">
                                <label>Size</label>
                                <input type="text" class="form-control" formControlName="size">
                            </div>

                            <div class="col">
                                <label>Weight</label>
                                <input type="number" class="form-control" formControlName="weight" step="0.01">
                            </div>
                        </div>
                    </section>

                    <section class="form-section" id="availability">
                        <h3>Availability</h3>

                        <div class="row flex-column gap-4">
                            <div class="col">
                                <label>Sell Start Date</label>
                                <input type="date" class="form-control" formControlName="sellStartDate" />
                            </div>

                            <div class="col">
                                <label>Sell End Date</label>
                                <input type="date" class="form-control" formControlName="sellEndDate" />
                                <div class="text-danger mt-1" *ngIf="form.errors?.['sellEndBeforeStart']">
                                    Sell end date cannot be before sell start date.
                                </div>
                            </div>

                            <div class="col">
                                <label>Discontinued Date</label>
                                <input type="date" class="form-control" formControlName="discontinuedDate" />
                                <div class="text-danger mt-1" *ngIf="form.errors?.['discontinuedBeforeStart']">
                                    Discontinued date cannot be before sell start date.
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <button class="btn btn-primary mt-3" type="submit" [disabled]="form.invalid || isSubmitting"
                    (click)="onUpdateClick()">
                    {{ isEditMode ? 'Update' : 'Create' }}
                </button>

            </form>
        </div>
    </div>

    <!-- MODAL SHOW DIFFERENCE -->
    <div class="modal-backdrop" *ngIf="isConfirmModalOpen">
        <div class="modal-card">
            <h3>Confirm changes</h3>
            <ul class="changes-list">
                <li *ngFor="let c of confirmationChanges">
                    <strong>{{ c.label }}</strong>:
                    <span class="before">{{ c.before }}</span>
                    →
                    <span class="after">{{ c.after }}</span>
                </li>
            </ul>
            <div class="modal-actions">
                <button class="btn btn-secondary" (click)="isConfirmModalOpen = false">
                    Cancel
                </button>
                <button class="btn btn-primary" (click)="confirmUpdate()">
                    Confirm update
                </button>
            </div>
        </div>
    </div>

</div>